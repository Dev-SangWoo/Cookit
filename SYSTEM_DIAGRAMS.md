# Cookit 시스템 다이어그램

## 1. 시스템 블록 다이어그램

### 1.1 전체 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                        Cookit Mobile App                        │
│                    (React Native / Expo)                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Auth       │  │  Navigation  │  │  Components  │          │
│  │   Module     │  │   Module     │  │   Shared     │          │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘          │
│         │                 │                  │                   │
│  ┌──────▼─────────────────▼──────────────────▼───────┐          │
│  │              Feature Modules                      │          │
│  ├──────────────┬──────────────┬──────────────┬─────┤          │
│  │   Recipe     │  Community   │  Profile    │Refrig│          │
│  │   Module     │   Module     │   Module    │Module│          │
│  └──────┬───────┴──────┬───────┴──────┬───────┴─────┘          │
│         │              │              │                        │
│  ┌──────▼──────────────▼──────────────▼──────────────┐         │
│  │          Shared Services Layer                      │         │
│  │  - recipeService    - postsApi                      │         │
│  │  - userApi          - receiptItemsApi                │         │
│  │  - notificationService                               │         │
│  └──────────────────────┬──────────────────────────────┘         │
│                         │                                        │
└─────────────────────────┼────────────────────────────────────────┘
                          │ HTTP/HTTPS
                          │
┌─────────────────────────▼────────────────────────────────────────┐
│                    Backend Server (Node.js)                       │
│                        (Express)                                  │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Routes      │  │   Services   │  │   Migrations │          │
│  │   Layer       │  │   Layer      │  │              │          │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘          │
│         │                 │                  │                   │
│  ┌──────▼─────────────────▼──────────────────▼───────┐          │
│  │  - recipes.js      - supabaseService.js            │          │
│  │  - recommendations.js - geminiService.js            │          │
│  │  - youtube.js      - aiPipelineService.js          │          │
│  │  - userPosts.js    - ocrHandler.js                 │          │
│  │  - receiptItems.js                                │          │
│  └──────────────────────┬─────────────────────────────┘          │
│                         │                                        │
└─────────────────────────┼────────────────────────────────────────┘
                          │
          ┌───────────────┼───────────────┐
          │               │               │
          ▼               ▼               ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│   Supabase   │  │   Gemini    │  │   YouTube    │
│   Database   │  │     API     │  │     API      │
│   (PostgreSQL│  │              │  │              │
│   + Auth +   │  │              │  │              │
│   Storage)   │  │              │  │              │
└──────────────┘  └──────────────┘  └──────────────┘
```

### 1.2 모바일 앱 내부 구조

```
┌─────────────────────────────────────────────────────────────┐
│                      App.js (Root)                         │
│  ┌──────────────────────────────────────────────────────┐   │
│  │            AuthProvider                              │   │
│  │  ┌──────────────────────────────────────────────┐   │   │
│  │  │         AnalysisProvider                      │   │   │
│  │  │  ┌────────────────────────────────────────┐ │   │   │
│  │  │  │      AuthNavigator                      │ │   │   │
│  │  │  │  ┌──────────────────────────────────┐ │ │   │   │
│  │  │  │  │    NavigationContainer             │ │ │   │   │
│  │  │  │  │  ┌────────────────────────────┐ │ │ │   │   │
│  │  │  │  │  │  Stack Navigator            │ │ │ │   │   │
│  │  │  │  │  │  - Auth Screen              │ │ │ │   │   │
│  │  │  │  │  │  - Setup Screens            │ │ │ │   │   │
│  │  │  │  │  │  - HomeTab                   │ │ │ │   │   │
│  │  │  │  │  │    - HomeMain                │ │ │ │   │   │
│  │  │  │  │  │    - RecipeList              │ │ │ │   │   │
│  │  │  │  │  │    - SearchStack             │ │ │ │   │   │
│  │  │  │  │  │    - CommunityStack          │ │ │ │   │   │
│  │  │  │  │  │    - Profile                 │ │ │ │   │   │
│  │  │  │  │  └────────────────────────────┘ │ │ │   │   │
│  │  │  │  └──────────────────────────────────┘ │ │   │   │
│  │  │  └────────────────────────────────────────┘ │   │   │
│  │  └──────────────────────────────────────────────┘   │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 1.3 데이터베이스 구조

```
┌─────────────────────────────────────────────────────────────┐
│                    Supabase (PostgreSQL)                    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────┐      ┌──────────────┐                   │
│  │ auth.users   │      │ user_profiles │                   │
│  │ (Auth)       │◄─────┤ (Profile)     │                   │
│  └──────────────┘      └──────┬───────┘                   │
│                               │                            │
│  ┌──────────────┐      ┌──────▼───────┐                   │
│  │  recipes     │◄─────┤ recipe_stats │                   │
│  │              │      │              │                   │
│  └──────┬───────┘      └──────────────┘                   │
│         │                                                 │
│  ┌──────▼───────┐      ┌──────────────┐                   │
│  │recipe_likes  │      │user_posts    │                   │
│  │              │      │(Community)   │                   │
│  └──────────────┘      └──────┬───────┘                   │
│                               │                            │
│  ┌──────────────┐      ┌──────▼───────┐                   │
│  │receipt_items │      │post_likes    │                   │
│  │(Refrigerator)│      │              │                   │
│  └──────────────┘      └──────────────┘                   │
│                                                             │
│  ┌──────────────┐      ┌──────────────┐                   │
│  │recipe_comments│      │recipe_categories│                │
│  │              │      │              │                   │
│  └──────────────┘      └──────────────┘                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 시퀀스 다이어그램

### 2.1 사용자 로그인 시퀀스

```
사용자    AuthScreen    GoogleSignInButton    AuthContext    Supabase Auth    Google OAuth
  │            │              │                  │                │                │
  │            │              │                  │                │                │
  │──로그인 버튼 클릭──────────>│                  │                │                │
  │            │              │                  │                │                │
  │            │──OAuth 요청──>│                  │                │                │
  │            │              │                  │                │                │
  │            │              │──signInWithOAuth──>│                │                │
  │            │              │                  │                │                │
  │            │              │                  │──OAuth URL 요청──>│                │
  │            │              │                  │                │                │
  │            │              │                  │                │──리디렉션──────>│
  │            │              │                  │                │                │
  │            │              │                  │                │<──토큰──────────│
  │            │              │                  │                │                │
  │            │              │                  │<──세션──────────│                │
  │            │              │                  │                │                │
  │            │              │<──성공────────────│                │                │
  │            │              │                  │                │                │
  │            │<──세션 설정 완료──│                  │                │                │
  │            │              │                  │                │                │
  │<──로그인 완료──────────│              │                  │                │                │
  │            │              │                  │                │                │
  │            │              │                  │                │                │
```

### 2.2 레시피 조회 및 조회수 증가 시퀀스

```
사용자    HomeMain    Summary    recipeService    Server    Supabase DB
  │          │          │            │            │            │
  │──홈 화면 진입──>│          │            │            │            │
  │          │          │            │            │            │
  │          │──추천 레시피 요청───────────>│            │            │
  │          │          │            │            │            │
  │          │          │            │──GET /api/recommendations──>│            │
  │          │          │            │            │            │
  │          │          │            │            │──SELECT recipes──>│
  │          │          │            │            │            │
  │          │          │            │            │<──레시피 데이터───│
  │          │          │            │            │            │
  │          │          │            │<──레시피 목록─────────│            │
  │          │          │            │            │            │
  │          │<──레시피 목록 표시──────│            │            │            │
  │          │          │            │            │            │
  │──레시피 카드 클릭──>│          │            │            │            │
  │          │          │            │            │            │
  │          │──Summary 화면으로 이동──>│            │            │            │
  │          │          │            │            │            │
  │          │          │──조회수 증가 요청─────────>│            │            │
  │          │          │            │            │            │
  │          │          │            │──POST /api/recipes/:id/view──>│            │
  │          │          │            │            │            │
  │          │          │            │            │──UPDATE recipe_stats──>│
  │          │          │            │            │            │
  │          │          │            │            │<──업데이트 완료──────│
  │          │          │            │            │            │
  │          │          │            │<──성공─────────│            │
  │          │          │            │            │            │
  │          │<──레시피 상세 표시──────│            │            │            │
  │          │          │            │            │            │
  │──뒤로가기──>│          │            │            │            │
  │          │          │            │            │            │
  │          │──useFocusEffect 트리거───────>│            │            │
  │          │          │            │            │            │
  │          │──최신 데이터 갱신───────────>│            │            │            │
  │          │          │            │            │            │
  │<──업데이트된 조회수 표시──│          │            │            │            │
  │          │          │            │            │            │
```

### 2.3 YouTube 영상 분석 시퀀스

```
사용자    SearchList    YouTubeAnalysisModal    AnalysisContext    recipeService    Server    Gemini API    Supabase
  │          │              │                    │                  │            │            │            │
  │──검색──>│              │                    │                  │            │            │            │
  │          │              │                    │                  │            │            │            │
  │          │<──검색 결과───│                    │                  │            │            │            │
  │          │              │                    │                  │            │            │            │
  │──영상 선택──>│              │                    │                  │            │            │            │
  │          │              │                    │                  │            │            │            │
  │          │──모달 열기───>│                    │                  │            │            │            │
  │          │              │                    │                  │            │            │            │
  │──분석 시작──>│              │                    │                  │            │            │            │
  │          │              │                    │                  │            │            │            │
  │          │              │──startAnalysis──────>│                  │            │            │            │
  │          │              │                    │                  │            │            │            │
  │          │              │                    │──analyzeYouTubeVideo──>│            │            │            │
  │          │              │                    │                  │            │            │            │
  │          │              │                    │                  │──POST /api/youtube-analysis/start──>│            │            │
  │          │              │                    │                  │            │            │            │
  │          │              │                    │                  │            │──영상 다운로드──>│            │
  │          │              │                    │                  │            │            │            │
  │          │              │                    │                  │            │──프레임 추출───>│            │
  │          │              │                    │                  │            │            │            │
  │          │              │                    │                  │            │──OCR 처리──────>│            │
  │          │              │                    │                  │            │            │            │
  │          │              │                    │                  │            │──Whisper 자막──>│            │
  │          │              │                    │                  │            │            │            │
  │          │              │                    │                  │            │──Gemini 분석───>│            │
  │          │              │                    │                  │            │            │            │
  │          │              │                    │                  │            │<──분석 결과─────│            │
  │          │              │                    │                  │            │            │            │
  │          │              │                    │                  │            │──레시피 저장──>│            │
  │          │              │                    │                  │            │            │            │
  │          │              │                    │                  │<──분석 완료─────│            │            │
  │          │              │                    │                  │            │            │            │
  │          │              │                    │──폴링 시작──────────>│            │            │            │
  │          │              │                    │                  │            │            │            │
  │          │              │                    │──getAnalysisStatus──>│            │            │            │
  │          │              │                    │                  │            │            │            │
  │          │              │                    │                  │──GET /api/youtube-analysis/result/:id──>│            │            │
  │          │              │                    │                  │            │            │            │
  │          │              │                    │                  │            │──SELECT recipes──>│            │
  │          │              │                    │                  │            │            │            │
  │          │              │                    │                  │            │<──레시피 데이터───│            │
  │          │              │                    │                  │            │            │            │
  │          │              │                    │                  │<──레시피─────────│            │            │
  │          │              │                    │                  │            │            │            │
  │          │              │<──분석 완료──────────│                  │            │            │            │
  │          │              │                    │                  │            │            │            │
  │          │<──Summary 화면으로 이동──────────│                  │            │            │            │
  │          │              │                    │                  │            │            │            │
  │<──레시피 표시──────────│              │                    │                  │            │            │            │
  │          │              │                    │                  │            │            │            │
```

### 2.4 레시피 조리 가이드 시퀀스 (음성 제어 포함)

```
사용자    Summary    RecipeMain    YouTubePlayer    PorcupineManager    RhinoManager    Server    Supabase
  │          │          │              │                │                  │            │            │
  │──레시피 선택──>│          │              │                │                  │            │            │
  │          │          │              │                │                  │            │            │
  │          │──RecipeMain 이동──>│              │                │                  │            │            │
  │          │          │              │                │                  │            │            │
  │          │          │──레시피 데이터 요청──────────────────────────────────────────────>│            │
  │          │          │              │                │                  │            │            │
  │          │          │              │                │                  │            │<──레시피 데이터───│
  │          │          │              │                │                  │            │            │
  │          │          │<──레시피 데이터──────────│                │                  │            │            │
  │          │          │              │                │                  │            │            │
  │          │          │──YouTube 영상 로드──>│                │                  │            │            │
  │          │          │              │                │                  │            │            │
  │──음성 허용 ON──>│          │              │                │                  │            │            │
  │          │          │              │                │                  │            │            │
  │          │          │──PorcupineManager 초기화────────────────>│                  │            │            │
  │          │          │              │                │                  │            │            │
  │          │          │              │                │──Wake word 감지 시작──>│            │            │
  │          │          │              │                │                  │            │            │
  │──"다음 단계"──>│          │              │                │                  │            │            │
  │          │          │              │                │──Wake word 감지───>│            │            │
  │          │          │              │                │                  │            │            │
  │          │          │              │                │                  │──Rhino 활성화──>│            │
  │          │          │              │                │                  │            │            │
  │          │          │              │                │                  │──음성 명령 처리──>│            │
  │          │          │              │                │                  │            │            │
  │          │          │<──다음 단계로 이동──────────│                │                  │            │            │
  │          │          │              │                │                  │            │            │
  │          │          │──YouTube 타임스탬프 이동──>│                │                  │            │            │
  │          │          │              │                │                  │            │            │
  │──조리 완료──>│          │              │                │                  │            │            │
  │          │          │              │                │                  │            │            │
  │          │          │──레시피 기록 저장──────────────────────────────────────────────>│            │
  │          │          │              │                │                  │            │            │
  │          │          │              │                │                  │            │──INSERT user_recipes──>│
  │          │          │              │                │                  │            │            │
  │          │          │              │                │                  │            │<──저장 완료─────────│
  │          │          │              │                │                  │            │            │
  │          │          │<──저장 완료──────────│                │                  │            │            │
  │          │          │              │                │                  │            │            │
```

### 2.5 재료 관리 (영수증 OCR) 시퀀스

```
사용자    ReceiptMain    ImagePicker    receiptItemsApi    Server    OCR Service    Supabase
  │          │              │                │            │            │            │
  │──영수증 인식 화면 진입──>│              │                │            │            │
  │          │              │                │            │            │            │
  │──영수증 촬영/업로드──>│              │                │            │            │
  │          │              │                │            │            │            │
  │          │──이미지 선택──>│                │            │            │            │
  │          │              │                │            │            │            │
  │          │              │──이미지 업로드──────────────────────>│            │            │
  │          │              │                │            │            │            │
  │          │              │                │──POST /api/receipt/ocr──>│            │            │
  │          │              │                │            │            │            │
  │          │              │                │            │──OCR 처리───>│            │
  │          │              │                │            │            │            │
  │          │              │                │            │<──텍스트 추출──│            │
  │          │              │                │            │            │            │
  │          │              │                │<──재료 목록─────────│            │            │
  │          │              │                │            │            │            │
  │          │<──재료 목록 표시──────────│            │            │            │
  │          │              │                │            │            │            │
  │──재료 확인/수정──>│              │                │            │            │
  │          │              │                │            │            │            │
  │──저장──>│              │                │            │            │            │
  │          │              │                │            │            │            │
  │          │──재료 저장───────────────────────────>│            │            │
  │          │              │                │            │            │            │
  │          │              │                │──POST /api/receipt-items──>│            │            │
  │          │              │                │            │            │            │
  │          │              │                │            │──INSERT receipt_items──>│
  │          │              │                │            │            │            │
  │          │              │                │            │<──저장 완료───────────│
  │          │              │                │            │            │            │
  │          │              │                │<──성공─────────────│            │            │
  │          │              │                │            │            │            │
  │          │<──저장 완료──────────│            │            │            │
  │          │              │                │            │            │            │
  │──내 냉장고 화면──>│              │                │            │            │
  │          │              │                │            │            │            │
  │          │──재료 목록 조회───────────────────────────>│            │            │
  │          │              │                │            │            │            │
  │          │              │                │──GET /api/receipt-items──>│            │            │
  │          │              │                │            │            │            │
  │          │              │                │            │──SELECT receipt_items──>│
  │          │              │                │            │            │            │
  │          │              │                │            │<──재료 목록───────────│
  │          │              │                │            │            │            │
  │          │              │                │<──재료 목록─────────────│            │            │
  │          │              │                │            │            │            │
  │<──재료 목록 표시──────────│            │            │            │
  │          │              │                │            │            │            │
```

### 2.6 커뮤니티 게시글 작성 시퀀스

```
사용자    CommunityMain    CommunityCreate    RecipeSelectModal    postsApi    Server    Supabase
  │          │              │                    │                  │            │            │
  │──글쓰기 버튼 클릭──>│              │                    │                  │            │            │
  │          │              │                    │                  │            │            │
  │          │──CommunityCreate 이동──>│                    │                  │            │            │
  │          │              │                    │                  │            │            │
  │──제목 입력──>│              │                    │                  │            │            │
  │          │              │                    │                  │            │            │
  │──레시피 선택──>│              │                    │                  │            │            │
  │          │              │                    │                  │            │            │
  │          │              │──RecipeSelectModal 열기──>│                  │            │            │
  │          │              │                    │                  │            │            │
  │──레시피 검색──>│              │                    │                  │            │            │
  │          │              │                    │──레시피 목록 요청───────────────────>│            │
  │          │              │                    │                  │            │            │
  │          │              │                    │                  │──SELECT recipes──>│
  │          │              │                    │                  │            │            │
  │          │              │                    │                  │<──레시피 목록──────│
  │          │              │                    │                  │            │            │
  │          │              │<──레시피 목록 표시──────────│            │            │
  │          │              │                    │                  │            │            │
  │──레시피 선택──>│              │                    │                  │            │            │
  │          │              │                    │                  │            │            │
  │          │              │<──선택된 레시피──────────│            │            │
  │          │              │                    │                  │            │            │
  │──내용 입력──>│              │                    │                  │            │            │
  │          │              │                    │                  │            │            │
  │──이미지 업로드──>│              │                    │                  │            │            │
  │          │              │                    │                  │            │            │
  │──태그 선택──>│              │                    │                  │            │            │
  │          │              │                    │                  │            │            │
  │──저장──>│              │                    │                  │            │            │
  │          │              │                    │                  │            │            │
  │          │              │──유효성 검사──────────│            │            │            │
  │          │              │                    │                  │            │            │
  │          │              │──createPost───────────>│            │            │            │
  │          │              │                    │                  │            │            │
  │          │              │                    │──POST /api/user-posts──>│            │            │
  │          │              │                    │                  │            │            │
  │          │              │                    │                  │──INSERT user_posts──>│
  │          │              │                    │                  │            │            │
  │          │              │                    │                  │<──저장 완료──────────│
  │          │              │                    │                  │            │            │
  │          │              │                    │<──성공─────────────│            │            │
  │          │              │                    │                  │            │            │
  │          │<──저장 완료──────────│            │            │            │
  │          │              │                    │                  │            │            │
  │──CommunityMain으로 이동──>│              │                    │                  │            │            │
  │          │              │                    │                  │            │            │
  │<──게시글 목록 표시──────────│            │            │            │
  │          │              │                    │                  │            │            │
```

---

## 3. 상태 다이어그램

### 3.1 인증 상태 전이

```
        [시작]
          │
          ▼
    ┌───────────┐
    │  로딩 중   │
    └─────┬─────┘
          │
    ┌─────▼─────┐
    │ 세션 확인  │
    └─────┬─────┘
          │
    ┌─────▼─────────────┐
    │                   │
    ▼                   ▼
[로그인 안됨]      [로그인됨]
    │                   │
    │                   ▼
    │            ┌──────────────┐
    │            │ Setup 확인   │
    │            └──────┬───────┘
    │                   │
    │            ┌──────▼───────┐
    │            │             │
    │            ▼             ▼
    │      [Setup 미완료]  [Setup 완료]
    │            │             │
    │            │             ▼
    │            │      ┌──────────────┐
    │            │      │  메인 앱     │
    │            │      └──────────────┘
    │            │
    │            └──────────────┘
    │
    │──로그인 시도──>│
    │                   │
    │                   ▼
    │            ┌──────────────┐
    │            │ OAuth 인증   │
    │            └──────┬───────┘
    │                   │
    │            ┌──────▼───────┐
    │            │             │
    │            ▼             ▼
    │      [성공]         [실패]
    │            │             │
    │            │             └──>[로그인 안됨]
    │            │
    │            └──>[로그인됨]
    │
    └──────────────────────────────┘
```

### 3.2 레시피 분석 상태 전이

```
        [시작]
          │
          ▼
    ┌───────────┐
    │  분석 요청 │
    └─────┬─────┘
          │
          ▼
    ┌───────────┐
    │ processing │
    └─────┬─────┘
          │
    ┌─────▼─────┐
    │           │
    ▼           ▼
[완료]      [실패]
    │           │
    │           └──>[에러 처리]
    │
    └──>[레시피 저장]
              │
              ▼
        [Summary 표시]
```

---

## 4. 컴포넌트 상호작용 다이어그램

### 4.1 레시피 추천 시스템 상호작용

```
┌──────────────┐
│  HomeMain    │
└──────┬───────┘
       │
       │ 1. fetchAllRecipes()
       │
       ▼
┌──────────────┐
│ recipeService│
└──────┬───────┘
       │
       │ 2. 개인화 추천
       │ 3. 인기 레시피
       │ 4. 난이도 추천
       │ 5. 유사 레시피
       │
       ▼
┌──────────────┐     ┌──────────────┐
│   Server     │────>│  Supabase    │
│recommendations│     │  Database    │
└──────┬───────┘     └──────────────┘
       │
       │ 6. 추천 결과
       │
       ▼
┌──────────────┐
│  RecipeCard  │
│  (다중)      │
└──────┬───────┘
       │
       │ 7. 사용자 선택
       │
       ▼
┌──────────────┐
│   Summary    │
└──────────────┘
```

---

## 5. 데이터 흐름 다이어그램

### 5.1 조회수 증가 데이터 흐름

```
┌──────────────┐
│   Summary    │
│   (화면)     │
└──────┬───────┘
       │
       │ incrementViewCount(recipeId)
       │
       ▼
┌──────────────┐
│recipeService │
└──────┬───────┘
       │
       │ POST /api/recipes/:id/view
       │
       ▼
┌──────────────┐
│   Server      │
│  recipes.js   │
└──────┬───────┘
       │
       │ UPDATE recipe_stats
       │ SET view_count = view_count + 1
       │
       ▼
┌──────────────┐
│  Supabase    │
│  Database     │
└──────┬───────┘
       │
       │ 업데이트 완료
       │
       ▼
┌──────────────┐
│  HomeMain    │
│  (useFocusEffect)│
│  데이터 갱신  │
└──────────────┘
```

---

*이 문서는 Cookit 프로젝트의 시스템 아키텍처와 주요 기능의 상호작용을 다이어그램으로 표현한 것입니다.*

